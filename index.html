<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Maryland Precinct Election Results</title>

    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link
      href="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      h1{
        text-align: left;
        margin: 10px;
        text-align: left;
        padding-left: 20px;
        padding-right: 20px;
      }

      h2,
      h3 {
        margin: 10px;
        font-size: 20px;
      }

      h3 {
        font-size: 16px;
      }

      p {
        margin: 10px;
        text-align: left;
        padding-left: 20px;
        padding-right: 20px;
        
      }

      #pd {
        font-size: 16px;
        font-family: Arial, Helvetica, sans-serif;
      }

      .map-overlay {
        position: absolute;
        bottom: 0;
        /* background: rgba(93, 117, 126, 0.85); */
        background-color: rgba(60, 67, 78, 0.85);
        /* background-color: #7070ed;
        opacity: 0.8; */
        width: 320px;
        margin-left: 40px;
        font-family: Arial, Helvetica, sans-serif;
        overflow: auto;
        border-radius: 5px;
        color: white;
        margin-top: 40px;
        text-align: left;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

      #features {
        left: 0;
        height: 500px;
        box-shadow: 0 1px 2px rgb(0 0 0 / 10%);
        /* width: 300px; */
        top: 0;
        padding-left: 10px;
        padding-top: 30px;
        text-align: center;
        
        
      }

      .geocoder-container {
    display: flex;
    align-items: center; /* Align items vertically */
    gap: 0px; /* Add spacing between the geocoder and button */
    margin-left: 30px; 
    margin-top: 20px;
    }

    .geocoder {
        flex: 1; /* Make the geocoder take up available space */
    }

    .feature-button {
        background: none;
        border: none;
        color: black;
        font-family: Arial, sans-serif;
        font-weight: bold;
        font-size: 12px;
        cursor: pointer;
        padding: 10px;
        width: 40px; /* Adjust size of the button */
        height: 40px; /* Adjust size of the button */
        display: flex;
        align-items: row;
        justify-content: center;
    }

    .feature-button img {
        width: 20px; /* Adjust size of the image */
        height: 20px;
    }


  /* Media query for smaller screens */
@media screen and (max-width: 600px) {
    .map-overlay {
        width: 70%;
        max-width: none;
        left: 5%;
        right: 5%;
    }
}
    </style>

  </head>
  <body>

    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

    <div id="map"></div>
    <div class="map-overlay" id="features">
        <h1>How Did Your Precinct Vote in 2024?</h1>
        <p>
          Around 500 precincts in Maryland saw former President Donald Trump leading in the 2024 elections, up from 140 in 2020. While the state remains solidly blue, with Vice President Kamala Harris leading in nearly 1,400 precincts, Trumpâ€™s gains tripled his 2020 performance.
        </p>
        <p>Type your address below to see how your precinct voted:</p>
        <div class="geocoder-container">
            <div id="geocoder" class="geocoder"></div>
            <button id="resetViewButton" class="feature-button">
              <img src="assets/reset-light.png" alt="Reset View" />
            </button>
        </div>
        <div id="pd"><p>Or hover over a precinct.</p></div>
  </div>

    <script>
// Define default center and zoom level
const defaultCenter = [-77.34039, 38.90108];
const marylandBounds = [
    [-83.11812, 36.41225], 
    [-73.86812, 40.64762]
];
const defaultZoom = 7.5;

// Initialize the map
mapboxgl.accessToken = 'pk.eyJ1IjoicnlhbmxpdHRsZSIsImEiOiJjbHhjN3Q3aGwwMDJ0MmpvbzUyMzdoc2lkIn0.esK-vXAPC8mP0teJo9Vn6g';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/ryanlittle/cm3x6wy2l00as01qq3etaaz7d',
    center: defaultCenter,
    zoom: defaultZoom,
    maxBounds: marylandBounds
});

// Add geocoder
const geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    mapboxgl: mapboxgl,
    placeholder: 'Type an address',
    bbox: [...marylandBounds[0], ...marylandBounds[1]]
});

document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

// Event listener for geocoder result to zoom into the selected location
geocoder.on('result', function(e) {
    map.flyTo({
        center: e.result.center,
        zoom: 14  // Adjust zoom level as needed when searching an address
    });
});


// Reset View button functionality
document.getElementById('resetViewButton').addEventListener('click', function() {
    map.flyTo({
        center: defaultCenter,
        zoom: defaultZoom
    });
});



// coverage_area_results_2024-7sgbou
// ryanlittle.1r5sbdco

map.on('load', () => {
    // Add the vector source
    map.addSource('data', {
        type: 'vector',
        url: 'mapbox://ryanlittle.1r5sbdco'
    });

    map.addLayer({
      id: 'precinct-layer',
      type: 'fill',
      source: 'data',
      'source-layer': 'coverage_area_results_2024-7sgbou',
      paint:{
        'fill-color': '#FF0000',
        'fill-opacity': 0
      }
    });


    // Create a popup for hover interaction
    const popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    });

    // Mousemove event for hover interaction
    map.on('mousemove', 'precinct-layer', (event) => {
        map.getCanvas().style.cursor = 'pointer';

        const feature = event.features[0];
        const precinctName = feature.properties.name; // Precinct name
        const pctTrump = feature.properties.pct_trump.toFixed(1); // Trump percentage
        const pctHarris = feature.properties.pct_harris.toFixed(1); // Harris percentage

 // Set popup content and position
 popup.setLngLat(event.lngLat)
            .setHTML(`
                <strong>${precinctName}</strong><br>
                <p><strong>Trump:</strong> ${pctTrump}%</p>
                <p><strong>Harris:</strong> ${pctHarris}%</p>
            `)
            .addTo(map);

        // Optionally update an HTML element outside the map
        document.getElementById('pd').innerHTML = `
            <p><strong>${precinctName}</strong></p>
            <p>Trump: ${pctTrump}%</p>
            <p>Harris: ${pctHarris}%</p>
        `;
    });

    // Remove popup on mouse leave
    map.on('mouseleave', 'precinct-layer', () => {
        map.getCanvas().style.cursor = '';
        popup.remove();

        // Reset the HTML element
        document.getElementById('pd').innerHTML = '<p>Or hover over a precinct.</p>';
    });
});


 
</script>
</body>
</html>